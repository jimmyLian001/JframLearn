<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.baofu.international.global.account.core.dal.mapper.UserSecrueqaInfoMapper">
    <resultMap id="BaseResultMap" type="com.baofu.international.global.account.core.dal.model.UserSecrueqaInfoDo">
        <id column="ID" jdbcType="BIGINT" property="id"/>
        <result column="USER_NO" jdbcType="BIGINT" property="userNo"/>
        <result column="QUESTION_SEQUENCE" jdbcType="TINYINT" property="questionSequence"/>
        <result column="QUESTION_NO" jdbcType="BIGINT" property="questionNo"/>
        <result column="ANSWER" jdbcType="VARCHAR" property="answer"/>
        <result column="CREATE_AT" jdbcType="TIMESTAMP" property="createAt"/>
        <result column="CREATE_BY" jdbcType="VARCHAR" property="createBy"/>
        <result column="UPDATE_AT" jdbcType="TIMESTAMP" property="updateAt"/>
        <result column="UPDATE_BY" jdbcType="VARCHAR" property="updateBy"/>
        <result column="STATE" jdbcType="TINYINT" property="state"/>
    </resultMap>

    <resultMap id="BaseResultMap2" type="com.baofu.international.global.account.core.dal.model.UserQuestionDo">
        <result column="USER_NO" property="userNo" jdbcType="BIGINT"/>
        <result column="QUESTION_SEQUENCE" property="questionSequence" jdbcType="TINYINT"/>
        <result column="QUESTION_NO" property="questionNo" jdbcType="BIGINT"/>
        <result column="QUESTION" property="question" jdbcType="VARCHAR"/>
        <result column="ANSWER" property="answer" jdbcType="VARCHAR"/>
    </resultMap>

    <sql id="Base_Column_List">
        ID,
        USER_NO,
        QUESTION_SEQUENCE,
        QUESTION_NO,
        ANSWER,
        CREATE_AT,
        CREATE_BY,
        UPDATE_AT,
        UPDATE_BY
    </sql>

    <select id="selectByUserNo" resultMap="BaseResultMap">
        SELECT
        <include refid="Base_Column_List"/>
        FROM
        T_USER_SECRUEQA_INFO
        WHERE
        USER_NO = #{userNo,jdbcType=BIGINT}
    </select>
    <insert id="insert" parameterType="com.baofu.international.global.account.core.dal.model.UserSecrueqaInfoDo">
        insert into T_USER_SECRUEQA_INFO (ID, USER_NO, QUESTION_SEQUENCE,
        QUESTION_NO, ANSWER, CREATE_AT,
        CREATE_BY, UPDATE_AT, UPDATE_BY
        )
        values (#{id,jdbcType=BIGINT}, #{userNo,jdbcType=BIGINT}, #{questionSequence,jdbcType=TINYINT},
        #{questionNo,jdbcType=BIGINT}, #{answer,jdbcType=VARCHAR}, NOW(),
        #{createBy,jdbcType=VARCHAR}, #{updateAt,jdbcType=TIMESTAMP}, #{updateBy,jdbcType=VARCHAR}
        )
    </insert>

    <!--新增用户安全问题-->
    <insert id="insertInfo" parameterType="com.baofu.international.global.account.core.dal.model.UserSecrueqaInfoDo">
        /**TUserSecrueqaInfoMapper.insertInfo**/
        insert into T_USER_SECRUEQA_INFO (
        USER_NO,
        QUESTION_SEQUENCE,
        QUESTION_NO,
        ANSWER,
        CREATE_AT,
        CREATE_BY,
        UPDATE_AT,
        UPDATE_BY
        )VALUES (
        #{userNo,jdbcType=BIGINT},
        #{questionSequence,jdbcType=TINYINT},
        #{questionNo,jdbcType=BIGINT},
        #{answer,jdbcType=VARCHAR},
        NOW(),
        #{createBy,jdbcType=VARCHAR},
        NOW(),
        #{updateBy,jdbcType=VARCHAR}
        )
    </insert>


    <select id="selectByQuestionNo" resultMap="BaseResultMap2"
            parameterType="com.baofu.international.global.account.core.dal.model.UserSecrueqaInfoDo">
        SELECT
        s.USER_NO,
        s.QUESTION_SEQUENCE,
        s.QUESTION_NO,
        t.QUESTION,
        s.ANSWER
        FROM
        T_USER_SECRUEQA_INFO s,T_SYS_SECRUEQA_INFO t
        WHERE s.QUESTION_NO = t.QUESTION_NO
        AND s.USER_NO = #{userNo,jdbcType=BIGINT}
        AND s.STATE=1
        <if test="questionNo != null">
            AND s.QUESTION_NO = #{questionNo,jdbcType=BIGINT}
        </if>
    </select>

    <update id="updatedByQuestionNo" parameterType="com.baofu.international.global.account.core.dal.model.UserSecrueqaInfoDo">
        UPDATE
        T_USER_SECRUEQA_INFO
        SET
        <if test="answer != null">
            ANSWER = #{answer,jdbcType=VARCHAR},
        </if>
        <if test="state != null">
            STATE = #{state,jdbcType=Integer},
        </if>
        UPDATE_AT = NOW(),
        UPDATE_BY = #{updateBy,jdbcType=VARCHAR}
        WHERE
        USER_NO = #{userNo,jdbcType=BIGINT}
        AND QUESTION_NO = #{questionNo,jdbcType=BIGINT}
    </update>

    <update id="deleteByUserNo">
        UPDATE
        T_USER_SECRUEQA_INFO
        SET STATE = 0,
        UPDATE_AT = NOW()
        WHERE
        USER_NO = #{userNo,jdbcType=BIGINT}
    </update>

</mapper>