<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.baofu.cbpayservice.dal.mapper.FiCbPaySettleApplyMapper">

    <resultMap id="BaseResultMap" type="com.baofu.cbpayservice.dal.models.FiCbPaySettleApplyDo">
        <id             column="ID"                     jdbcType="BIGINT"           property="id"/>
        <result         column="APPLY_ID"               jdbcType="BIGINT"           property="orderId"/>
        <result         column="MEMBER_ID"              jdbcType="BIGINT"           property="memberId"/>
        <result         column="INCOME_NO"              jdbcType="VARCHAR"          property="incomeNo"/>
        <result         column="ORDER_AMT"              jdbcType="DECIMAL"          property="orderAmt"/>
        <result         column="ORDER_CCY"              jdbcType="CHAR"             property="orderCcy"/>
        <result         column="INCOME_ACCOUNT_NAME"    jdbcType="VARCHAR"          property="incomeAccountName"/>
        <result         column="CREATE_AT"              jdbcType="TIMESTAMP"        property="createAt"/>
        <result         column="CREATE_BY"              jdbcType="VARCHAR"          property="createBy"/>
        <result         column="UPDATE_AT"              jdbcType="TIMESTAMP"        property="updateAt"/>
        <result         column="UPDATE_BY"              jdbcType="VARCHAR"          property="updateBy"/>
        <result         column="MATCHING_STATUS"        jdbcType="INTEGER"          property="matchingStatus"/>
        <result         column="MATCHING_ORDER_ID"      jdbcType="BIGINT"           property="matchingOrderId"/>
        <result         column="INCOME_ACCOUNT"         jdbcType="VARCHAR"          property="incomeAccount"/>
        <result         column="PAYMENT_FILE_ID"        jdbcType="BIGINT"           property="paymentFileId"/>
        <result         column="REMITTANCE_COUNTRY"     jdbcType="VARCHAR"          property="remittanceCountry"/>
        <result         column="REMITTANCE_ACC"         jdbcType="VARCHAR"          property="remittanceAcc"/>
        <result         column="REMITTANCE_NAME"        jdbcType="VARCHAR"          property="remittanceName"/>
        <result         column="REMARKS"                jdbcType="VARCHAR"          property="remarks"/>
        <result         column="INWARD_REMITTANCE_ID"   jdbcType="VARCHAR"          property="inwardRemittanceId"/>
	    <result         column="NOTIFY_URL"             jdbcType="VARCHAR"          property="notifyUrl"/>
        <result         column="TERMINAL_ID"            jdbcType="INTEGER"          property="terminalId"/>
    </resultMap>

    <sql id="Base_Column_List">
        ID,
        APPLY_ID,
        MEMBER_ID,
        INCOME_NO,
        ORDER_AMT,
        ORDER_CCY,
        INCOME_ACCOUNT_NAME,
        CREATE_AT,
        CREATE_BY,
        UPDATE_AT,
        UPDATE_BY,
        MATCHING_STATUS,
        MATCHING_ORDER_ID,
        INCOME_ACCOUNT,
        PAYMENT_FILE_ID,
        REMITTANCE_COUNTRY,
        REMITTANCE_ACC,
        REMITTANCE_NAME,
        REMARKS,
        INWARD_REMITTANCE_ID,
        NOTIFY_URL,
        TERMINAL_ID
    </sql>

    <insert id="insert" parameterType="com.baofu.cbpayservice.dal.models.FiCbPaySettleApplyDo">
        /*FiCbPaySettleApplyMapper.insert*/
        insert into FI_CBPAY_SETTLE_APPLY (
        APPLY_ID,
        MEMBER_ID,
        INCOME_NO,
        ORDER_AMT,
        ORDER_CCY,
        INCOME_ACCOUNT_NAME,
        CREATE_AT,
        CREATE_BY,
        UPDATE_AT,
        UPDATE_BY,
        MATCHING_STATUS,
        MATCHING_ORDER_ID,
        INCOME_ACCOUNT,
        PAYMENT_FILE_ID,
        REMITTANCE_COUNTRY,
        REMITTANCE_ACC,
        REMITTANCE_NAME,
        INCOME_BANK_NAME,
        NOTIFY_URL,
        TERMINAL_ID
        )values (
        #{orderId,jdbcType=BIGINT},
        #{memberId,jdbcType=BIGINT},
        #{incomeNo,jdbcType=VARCHAR},
        #{orderAmt,jdbcType=DECIMAL},
        #{orderCcy,jdbcType=CHAR},
        #{incomeAccountName,jdbcType=VARCHAR},
        NOW(),
        #{createBy,jdbcType=VARCHAR},
        NOW(),
        #{updateBy,jdbcType=VARCHAR},
        #{matchingStatus,jdbcType=INTEGER},
        #{matchingOrderId,jdbcType=BIGINT},
        #{incomeAccount,jdbcType=VARCHAR},
        #{paymentFileId,jdbcType=VARCHAR},
        #{remittanceCountry,jdbcType=VARCHAR},
        #{remittanceAcc,jdbcType=VARCHAR},
        #{remittanceName,jdbcType=VARCHAR},
        #{incomeBankName,jdbcType=VARCHAR},
        #{notifyUrl,jdbcType=VARCHAR},
        #{terminalId,jdbcType=INTEGER}
        )
    </insert>

    <update id="updateByKeySelective" parameterType="com.baofu.cbpayservice.dal.models.FiCbPaySettleApplyDo">
        /*FiCbPaySettleApplyMapper.updateByKeySelective*/
        update FI_CBPAY_SETTLE_APPLY
        <set>
            <if test="incomeAccountName != null">
                INCOME_ACCOUNT_NAME = #{incomeAccountName,jdbcType=VARCHAR},
            </if>
            <if test="updateBy != null">
                UPDATE_BY = #{updateBy,jdbcType=VARCHAR},
            </if>
            <if test="matchingStatus != null">
                MATCHING_STATUS = #{matchingStatus,jdbcType=INTEGER},
            </if>
            <if test="matchingOrderId != null">
                MATCHING_ORDER_ID = #{matchingOrderId,jdbcType=BIGINT},
            </if>
            <if test="remarks != null">
                REMARKS = #{remarks,jdbcType=VARCHAR},
            </if>
            <if test="inwardRemittanceId != null">
                INWARD_REMITTANCE_ID = #{inwardRemittanceId,jdbcType=VARCHAR},
            </if>
            <if test="paymentFileId != null">
                PAYMENT_FILE_ID = #{paymentFileId,jdbcType=BIGINT},
            </if>
            UPDATE_AT = NOW()
        </set>
        where APPLY_ID = #{orderId,jdbcType=BIGINT}
    </update>


    <!--根据匹配ID更新匹配状态-->
    <update id="updateByKeyMatchingOrderId">
        /*FiCbPaySettleApplyMapper.updateByKeyMatchingOrderId*/
        update FI_CBPAY_SETTLE_APPLY
        <set>
            <if test="status != null">
                MATCHING_STATUS = #{status,jdbcType=INTEGER},
            </if>
            UPDATE_AT = NOW()
        </set>
        where APPLY_ID = #{matchingOrderId,jdbcType=BIGINT}
    </update>

    <!-- 根据商户编号和TT编号（汇入编号）查询有效的记录 -->
    <select id="queryByIncomeNo" resultMap="BaseResultMap">
        /*FiCbPaySettleApplyMapper.queryByIncomeNo*/
        SELECT
        <include refid="Base_Column_List"/>
        FROM FI_CBPAY_SETTLE_APPLY F
        WHERE F.INCOME_NO = #{incomeNo,jdbcType=VARCHAR}
        <if test="memberId != null">
            AND F.MEMBER_ID = #{memberId,jdbcType=BIGINT}
        </if>
        AND F.MATCHING_STATUS != 13
    </select>

    <!-- 根据申请编号查询 -->
    <select id="queryByApplyNo" resultMap="BaseResultMap">
        /*FiCbPaySettleApplyMapper.queryByApplyNo*/
        SELECT
          <include refid="Base_Column_List"/>
        FROM
          FI_CBPAY_SETTLE_APPLY F
        WHERE
          F.APPLY_ID = #{orderId,jdbcType=BIGINT}
        AND
          F.MATCHING_STATUS != 13
    </select>


    <!-- 根据匹配编号查询 -->
    <select id="queryBySettleId" resultMap="BaseResultMap">
        /*FiCbPaySettleApplyMapper.queryByApplyNo*/
        SELECT
          <include refid="Base_Column_List"/>
        FROM
          FI_CBPAY_SETTLE_APPLY F
        WHERE
          F.MATCHING_ORDER_ID = #{matchingOrderId,jdbcType=BIGINT}
    </select>

    <!-- 根据参数查询 -->
    <select id="queryByParams" resultMap="BaseResultMap">
        /*FiCbPaySettleApplyMapper.queryByParams*/
        SELECT
          <include refid="Base_Column_List"/>
        FROM
          FI_CBPAY_SETTLE_APPLY F
        WHERE
          F.MEMBER_ID = #{memberId,jdbcType=BIGINT}
        AND
          F.INCOME_NO = #{incomeNo,jdbcType=VARCHAR}
    </select>

</mapper>