<?xml version="1.0" encoding="UTF-8"?>
<beans xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
       xmlns:rabbit="http://www.springframework.org/schema/rabbit"
       xmlns="http://www.springframework.org/schema/beans"
       xsi:schemaLocation="http://www.springframework.org/schema/beans
        http://www.springframework.org/schema/beans/spring-beans.xsd
        http://www.springframework.org/schema/rabbit
        http://www.springframework.org/schema/rabbit/spring-rabbit-1.3.xsd">

    <!-- 配置连接工厂 -->
    <rabbit:connection-factory id="connectionFactory"
                               host="${rabbitmq.address}"
                               port="${rabbitmq.port}"
                               username="${rabbitmq.username}"
                               password="${rabbitmq.password}"
                               virtual-host="${rabbitmq.vhost}"
                               connection-factory="refConnectionFactory"/>

    <!-- 配置心跳、超时、自动恢复-->
    <bean id="refConnectionFactory" class="com.rabbitmq.client.ConnectionFactory">
        <property name="requestedHeartbeat" value="240"/>
        <property name="connectionTimeout" value="10000"/>
        <property name="automaticRecoveryEnabled" value="true"/>
    </bean>

    <!-- 配置消费者监听器，指定队列名及监听类 -->
    <rabbit:listener-container connection-factory="connectionFactory" prefetch="1" concurrency="1" max-concurrency="1"
                               acknowledge="auto">
        <!-- 通知商户 -->
        <rabbit:listener queue-names="CBPAY_NOTIFY_MEMBER_QUEUE_NAME" ref="cbPayNotifyMemberListener"/>

        <!-- 通知清算 -->
        <rabbit:listener queue-names="CBPAY_NOTIFY_SETTLE_QUEUE_NAME" ref="cbPayNotifySettleListener"/>

        <!-- 渠道第一次异步通知 -->
        <rabbit:listener queue-names="com.baofoo.cbcgw.facade.dto.gw.CgwBaseResultDO"
                         ref="cbPayChannelNotifyRemittanceOrderListener"/>

        <!-- 渠道第二次异步通知 -->
        <rabbit:listener queue-names="com.baofoo.cbcgw.facade.dto.gw.response.CgwRemitBatchResultDto"
                         ref="cbPayNotifyRemittanceListener"/>

        <!-- 创建汇款订单V2 -->
        <rabbit:listener queue-names="CBPAY_CREATE_REMITTANCE_ORDER_QUEUE_NAME" ref="cbPayCreateRemittanceV2Listener"/>

        <!-- 汇款订单自动审核 -->
        <rabbit:listener queue-names="CBPAY_AUDIT_REMITTANCE_QUEUE_NAME" ref="cbPayAuditRemittanceListener"/>

        <!--付汇成功邮件通知MQ处理-->
        <rabbit:listener queue-names="CBPAY_REMITTANCE_EMAIL_QUEUE_NAME" ref="cbPayRemittanceEmailListener"/>

        <!-- 监听 汇款文件处理 -->
        <rabbit:listener queue-names="CBPAY_PROXY_CUSTOMS_QUEUE_NAME" ref="proxyCustomsListener"/>

        <!-- 监听 收汇通知处理（银行到账通知） -->
        <rabbit:listener queue-names="CBPAY_COLLECTION_QUEUE_NAME" ref="settleMoneyToAccountListener"/>

        <!-- 监听 结汇文件处理 -->
        <rabbit:listener queue-names="CBPAY_SETTLE_FILE_PROCESS_QUEUE_NAME" ref="settleFileProcessListener"/>

        <!-- 监听 结汇文件处理(仅用于结汇明细文件校验，数据不入库) -->
        <rabbit:listener queue-names="CBPAY_SETTLE_FILE_TEST_AND_VERIFY_PROCESS_QUEUE_NAME"
                         ref="settleFileVerifyProcessListener"/>

        <!--跨境海关通知MQ处理-->
        <rabbit:listener queue-names="CBPAY_DECLARE__NOTIFY_SERVICE_QUEUE_NAME" ref="haiGuanNotifyListener"/>

        <!--跨境结汇申请确认MQ处理-->
        <rabbit:listener queue-names="CBPAY_CROSS_SETTLE_CONFIRM" ref="cbPaySettleConfirmListener"/>

        <!--跨境结汇申请发往银行通知MQ处理-->
        <rabbit:listener queue-names="CBPAY_SETTLE_APPLY_QUEUE_NAME" ref="cbPaySettleNotifyListener"/>

        <!--跨境结汇申请银行渠道响应MQ处理-->
        <rabbit:listener queue-names="CBPAY_SETTLE_CALL_QUEUE_NAME" ref="cbPaySettleCallbackListener"/>

        <!--发送邮件MQ-->
        <rabbit:listener queue-names="CBPAY_SEND_EMAIL_QUEUE_NAME" ref="sendEmailListener"/>

        <!--跨境订单风控MQ处理-->
        <rabbit:listener queue-names="CBPAY_ORDER_RISKCONTROL_QUEUE_NAME" ref="cbPayOrderRiskControlListener"/>

        <!--提现订单文件处理MQ-->
        <rabbit:listener queue-names="CBPAY_WITHDRAW_FILE_UPLOAD_QUEUE_NAME" ref="orderRemitFileProcessListener"/>

        <!--提现订单文件处理MQ-->
        <rabbit:listener queue-names="CBPAY_WITHTIME_FILE_UPLOAD_QUEUE_NAME" ref="orderSumFileProcessListener"/>

        <!--解付申请MQ-->
        <rabbit:listener queue-names="CBPAY_SOLUTION_PAY_APPLE_QUEUE_NAME" ref="solutionPayApplyListener"/>

        <!--解付，渠道最终通知MQ-->
        <rabbit:listener queue-names="CBPAY_RELIEVE_QUEUE_NAME" ref="releveListener"/>

        <!--邮件通知清算处理MQ-->
        <rabbit:listener queue-names="CBPAY_EMAIL_NOTIFY_SETTLE_QUEUE_NAME" ref="sendEmailNotifySettleListener"/>

        <!--跨境订单风控MQ处理-->
        <rabbit:listener queue-names="CBPAY_ORDER_RISKCONTROL_QUEUE_NAME_SETTLE"
                         ref="cbPaySettleOrderRiskControlListener"/>

        <!--发送汇款凭证邮件队列MQ-->
        <rabbit:listener queue-names="CBPAY_REMIT_EMAIL_QUEUE_NAME" ref="cbPayRemitDocEmailListener"/>

        <!--结汇结果异步通知商户MQ-->
        <rabbit:listener queue-names="CBPAY_SETTLEMENT_ASYNC_NOTIFY_QUEUE_NAME" ref="settlementAsyncNotifyListener"/>

        <!-- 批量汇款创建文件MQ -->
        <rabbit:listener queue-names="CREATE_BATCH_REMIT_DETAIL_QUEUE_NAME" ref="createOrderDetailListener"/>

        <!-- 监听 汇款文件批次上传处理 -->
        <rabbit:listener queue-names="CBPAY_PROXY_CUSTOMS_SERIES_QUEUE_NAME" ref="proxyCustomsBatchListener"/>

    </rabbit:listener-container>
</beans>
